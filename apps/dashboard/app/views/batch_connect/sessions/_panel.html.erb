<%= session_panel session do %>
  <%= session_view session do %>
    <%
      if session.running?
        if session.view && ! session.script_type["vnc"]
          views = { partial: "custom", locals: { connect: session.connect, view: session.view } }
        else
          if session.script_type["vnc"]
            views = []
            views << { title: "noVNC Connection",    partial: "novnc",      locals: { connect: session.connect, app_title: session.title } }
            views << { title: "Native Instructions", partial: "native_vnc", locals: { connect: session.connect } } if ENV["ENABLE_NATIVE_VNC"]
          else
            views = { partial: "missing_connection" }
          end
        end
      elsif session.starting?
        views = { partial: "starting" }
      elsif session.queued?
        views = { partial: "queued" }
      else
        views = { partial: "bad" }
      end
    %>
    <%=
      connection_tabs(
        session.id,
        views,
        session.script_type["vnc"] ? true : false,
        session.running? && session.script_type["vnc"] ? { connect: session.connect, view: session.view } : nil,
      )
    %>
  <% end %>
<% end %>
