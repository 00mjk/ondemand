<%= session_panel session do %>
  <%= session_view session do %>
    <%
      if session.running?
        if session.view && session.script_type != "vnc"
          views = { partial: "custom", locals: { view: session.view, connect: session.connect } }
        else
          if session.script_type == "vnc"
            if session.view
            %>
              <hr/>
              <%= OodAppkit.markdown.render(ERB.new(session.view, nil, "-").result(session.connect.instance_eval { binding })).html_safe %>
              <hr/>
            <%
            end
            views = []
            views << { title: "noVNC Connection",    partial: "novnc",      locals: { connect: session.connect, app_title: session.title } }
            views << { title: "Native Instructions", partial: "native_vnc", locals: { connect: session.connect } } if ENV["ENABLE_NATIVE_VNC"]
          else
            views = { partial: "missing_connection" }
          end
        end
      elsif session.starting?
        views = { partial: "starting" }
      elsif session.queued?
        views = { partial: "queued" }
      else
        views = { partial: "bad" }
      end
    %>
    <%= connection_tabs(session.id, views) %>
  <% end %>
<% end %>
