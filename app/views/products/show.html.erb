<div class="page-header">
  <h2>
    <%= @product.name %> <%= git_prompt @product.router.path %>
  </h2>
</div>

<h3>Details</h3>

<div class="row">
  <div class="col-sm-2">
    <p>
      <%= image_tag app_icon_path(@product.app.name, @product.app.type, @product.app.owner), size: '100x100' %>
    </p>
  </div><!-- /.col-sm-2 -->
  <div class="col-sm-6">
    <p>
      <strong>Title:</strong>
      <%= link_to @product.app.title, app_path(@product.app.name, @product.app.type, @product.app.owner) %>
    </p>
    <p>
      <strong>Git remote:</strong>
      <%= @product.git_remote %>
    </p>
    <p>
      <strong>Description:</strong><br/>
      <%= manifest_markdown(@product.app.manifest.description) %>
    </p>
  </div><!-- /.col-sm-6 -->
  <div class="col-sm-2">
    <%= link_to 'Shell', OodAppkit.shell.url(path: @product.router.path).to_s, target: '_blank', class: 'btn btn-default btn-block' %>
    <%= link_to 'Files', OodAppkit.files.url(path: @product.router.path).to_s, target: '_blank', class: 'btn btn-default btn-block' %>
  </div><!-- /.col-sm-2 -->
  <div class="col-sm-2">
    <button class="btn btn-default btn-block" data-toggle="cli" data-target="<%= cli_product_path('bi', name: @product.name, type: @type) %>" data-title="<code>scl enable rh-ruby22 nodejs010 -- bin/bundle install --path=vendor/bundle</code>">
      Bundle Install
    </button>
    <%= link_to 'Restart App',restart_product_path(@product.name, type: @type), method: :patch, class: 'btn btn-default btn-block' %>
  </div><!-- /.col-sm-2 -->

</div><!-- /.row -->

<hr />

<% if @product.permissions? %>

<h3>Permissions</h3>

<div class="row">
  <div class="col-sm-6">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Users</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <% @product.users.each do |u| %>
        <tr>
          <td><%= u.name %> <%= "(Owner)" if u.owner %></td>
          <td><%= link_to 'Remove', product_permission_path(u.name, type: @type, product_name: @product.name, context: :user), method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-danger' unless u.owner %></td>
        </tr>
        <% end %>
      </tbody>
    </table>

    <p>
      <%= link_to 'New User Permission', new_product_permission_path(type: @type, product_name: @product.name, context: :user), class: 'btn btn-default' %>
    </p>
  </div><!-- /.col-sm-6 -->
  <div class="col-sm-6">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Groups</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <% @product.groups.each do |g| %>
        <tr>
          <td><%= g.name %> <%= "(Owner)" if g.owner %></td>
          <td><%= link_to 'Remove', product_permission_path(g.name, type: @type, product_name: @product.name, context: :group), method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-danger' unless g.owner %></td>
        </tr>
        <% end %>
      </tbody>
    </table>

    <p>
      <%= link_to 'New Group Permission', new_product_permission_path(type: @type, product_name: @product.name, context: :group), class: 'btn btn-default' %>
    </p>
  </div><!-- /.col-sm-6 -->
</div><!-- /.row -->

<hr />
<% end %>

<%= link_to 'Edit', edit_product_path(@product.name, type: @type), class: 'btn btn-default' %>
<%= link_to 'Back', products_path(type: @type), class: 'btn btn-default' %>
<%= link_to 'Delete App', product_path(@product.name, type: @type), method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-danger pull-right' %>

<div class="modal fade" id="productCliModal" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Command</h4>
      </div><!-- /.modal-header -->
      <div class="modal-body">
        <pre>
          Loading...
        </pre>
      </div><!-- /.modal-body -->
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
